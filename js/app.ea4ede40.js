(function(e){function t(t){for(var r,o,a=t[0],i=t[1],s=t[2],l=0,b=[];l<a.length;l++)o=a[l],Object.prototype.hasOwnProperty.call(c,o)&&c[o]&&b.push(c[o][0]),c[o]=0;for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r]);d&&d(t);while(b.length)b.shift()();return u.push.apply(u,s||[]),n()}function n(){for(var e,t=0;t<u.length;t++){for(var n=u[t],r=!0,a=1;a<n.length;a++){var i=n[a];0!==c[i]&&(r=!1)}r&&(u.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},c={app:0},u=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],i=a.push.bind(a);a.push=t,a=a.slice();for(var s=0;s<a.length;s++)t(a[s]);var d=i;u.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"0772":function(e,t,n){"use strict";n("1603")},1603:function(e,t,n){},"514f":function(e,t,n){},"745f":function(e,t,n){},"9fde":function(e,t,n){"use strict";n("beaa")},a710:function(e,t,n){"use strict";n("745f")},beaa:function(e,t,n){},cd49:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("7a23");function c(e,t,n,c,u,o){var a=Object(r["q"])("Editor"),i=Object(r["q"])("Strip"),s=Object(r["q"])("ModuleEditor"),d=Object(r["q"])("BLEConnector");return Object(r["j"])(),Object(r["d"])("div",null,[Object(r["g"])(a),Object(r["g"])(i),Object(r["g"])(s),Object(r["g"])(d)])}var u=n("bee2"),o=n("d4ec"),a=n("262e"),i=n("2caf"),s=n("9ab4"),d=n("ce1f"),l=(n("5377"),n("99af"),{class:"editor"}),b={class:"time"},f={class:"timeline"},j={class:"light_modules"},p=["onClick"],O=["onClick"],h={class:"progress_bar"};function v(e,t,n,c,u,o){return Object(r["j"])(),Object(r["d"])("div",l,[Object(r["e"])("button",{onClick:t[0]||(t[0]=function(){return e.playPause&&e.playPause.apply(e,arguments)})},"Play"),Object(r["e"])("div",b,Object(r["r"])(e.currentTime),1),Object(r["e"])("div",f,[Object(r["e"])("div",{class:"progress_line",style:Object(r["i"])("left: ".concat(e.progressWidth,"%"))},null,4),(Object(r["j"])(!0),Object(r["d"])(r["a"],null,Object(r["p"])(e.flags,(function(t){return Object(r["j"])(),Object(r["d"])("div",{class:"flag_line",key:t,style:Object(r["i"])("left: ".concat(100/e.duration*t.time,"%"))},Object(r["r"])(t.time),5)})),128)),Object(r["e"])("div",j,[(Object(r["j"])(!0),Object(r["d"])(r["a"],null,Object(r["p"])(e.modulesGroupedByLedGroup,(function(t,n){return Object(r["j"])(),Object(r["d"])("div",{class:"light_module_group",key:t,onClick:function(t){return e.updateSelectedGroup(t,n)}},[(Object(r["j"])(!0),Object(r["d"])(r["a"],null,Object(r["p"])(t,(function(t){return Object(r["j"])(),Object(r["d"])("div",{class:"light_module",key:t.id,style:Object(r["i"])("left: ".concat(t.startTime/e.duration*100,"%;width: ").concat(t.duration/e.duration*100,"%")),onClick:function(n){return e.selectModule(n,t)}},null,12,O)})),128))],8,p)})),128))]),Object(r["e"])("div",h,[Object(r["e"])("div",{class:"progress",style:Object(r["i"])("width: ".concat(e.progressWidth,"%"))},null,4)])])])}n("d3b7");var m=n("ade3"),g=n("b85c"),y=n("5530"),M=(n("cb29"),n("a434"),n("a4d3"),n("e01a"),n("5502")),S=n("2909"),w=(n("d81d"),n("c740"),n("4e82"),n("fb6a"),n("25f0"),n("b0c0"),Object(u["a"])((function e(t){Object(o["a"])(this,e),this.id=t||Math.random().toString(16).slice(2),this.moduleType=this.constructor.name}))),T=function(e){Object(a["a"])(n,e);var t=Object(i["a"])(n);function n(e){var r,c=e.duration,u=e.startTime,a=e.leds,i=e.id;return Object(o["a"])(this,n),r=t.call(this,i),r.duration=c,r.startTime=u,r.leds=a.sort(),r}return Object(u["a"])(n,[{key:"ledStateOnUpdate",value:function(e){var t,n=e/this.duration*100,r=2.55*n,c={},u=Object(g["a"])(this.leds);try{for(u.s();!(t=u.n()).done;){var o=t.value;c[o]={r:1*r,g:.5*r,b:0*r}}}catch(a){u.e(a)}finally{u.f()}return c}}]),n}(w);n("e9c4");function k(e,t){var n=t,r=function(){for(var t=arguments.length,r=new Array(t),c=0;c<t;c++)r[c]=arguments[c];var u=r[0],o=r[1];n(u,o);var a=JSON.stringify(u[e]);localStorage.setItem(e,a)};return r}function A(e,t){var n=JSON.parse(localStorage.getItem(e));return n||t}var _={state:{modules:A("modules",[]).map((function(e){e.moduleType;return F(e.moduleType,e)})),currentState:Object(y["a"])({},new Array(50).fill({r:0,g:0,b:0})),duration:12e4,activeModules:[],currentTime:0,updateFrequency:1e3},mutations:{setDuration:function(e,t){e.duration=t},setFrequency:function(e,t){e.updateFrequency=t},setCurrentTime:function(e,t){e.currentTime=t},setModules:k("modules",(function(e,t){e.modules=Object(S["a"])(t)})),setActiveModules:function(e,t){e.activeModules=Object(S["a"])(t)},setCurrentState:function(e,t){e.currentState=Object(y["a"])({},t)},addLightModule:k("modules",(function(e,t){e.modules.push(t)})),removeLightModule:k("modules",(function(e,t){e.modules.splice(e.modules.findIndex((function(e){return e.id===t})),1)}))}},x="setDuration",C="setCurrentTime",G="setFrequency",q="setModules",P="setActiveModules",L="setCurrentState",D="addLightModule",I="removeLightModule";function F(e,t){switch(e){case"Dimmer":return new T(t);default:throw new Error("Unknown moduleType ".concat(e))}}var $={state:{ledArrayState:Object(y["a"])({},new Array(60).fill({r:0,g:0,b:0}))},mutations:{updateLedArrayState:function(e,t){e.ledArrayState=Object(y["a"])(Object(y["a"])({},e.ledArrayState),t)}}},E={state:{selectedModule:null,selectedModuleGroup:null},mutations:{changeSelectedModule:function(e,t){e.selectedModule=t},changeSelectedModuleGroup:function(e,t){e.selectedModuleGroup=t}}},U="changeSelectedModule",J="changeSelectedModuleGroup",V=Symbol(),B=Object(M["a"])({modules:{ledArray:$,engine:_,ui:E}}),R=Object(y["a"])({},new Array(50).fill({r:0,g:0,b:0})),N=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;Object(o["a"])(this,e),this.store=Object(M["b"])(V),this.engineState=this.store.state.engine,this.timeoutIds=[],this.duration=t,this.updateFrequency=n}return Object(u["a"])(e,[{key:"duration",get:function(){return this.engineState.duration},set:function(e){this.store.commit(x,e)}},{key:"currentTime",get:function(){return this.engineState.currentTime},set:function(e){this.store.commit(C,e)}},{key:"updateFrequency",get:function(){return this.engineState.updateFrequency},set:function(e){this.store.commit(G,e)}},{key:"modules",get:function(){return this.engineState.modules},set:function(e){this.store.commit(q,e)}},{key:"activeModules",get:function(){return this.engineState.activeModules},set:function(e){this.store.commit(P,e)}},{key:"currentState",get:function(){return this.engineState.currentState},set:function(e){this.store.commit(L,e)}},{key:"addModule",value:function(e){this.store.commit(D,e)}},{key:"setup",value:function(){var e,t=this,n=Object(g["a"])(this.modules);try{var r=function(){var n=e.value,r=setTimeout((function(){t.activeModules.push(n)}),n.startTime-t.currentTime),c=setTimeout((function(){t.activeModules.splice(t.activeModules.indexOf(n),1);var e=n.leds.reduce((function(e,t){return Object(y["a"])(Object(y["a"])({},e),{},Object(m["a"])({},t,{r:0,g:0,b:0}))}),{});t.currentState=Object(y["a"])(Object(y["a"])({},t.currentState),e)}),n.startTime+n.duration-t.currentTime);t.timeoutIds.push(r,c)};for(n.s();!(e=n.n()).done;)r()}catch(c){n.e(c)}finally{n.f()}}},{key:"start",value:function(e){var t=this,n=!1;this.tickId=setInterval((function(){t.currentTime+=t.updateFrequency;var r,c=Object(g["a"])(t.activeModules);try{for(c.s();!(r=c.n()).done;){var u=r.value;t.currentState=Object(y["a"])(Object(y["a"])({},t.currentState),u.ledStateOnUpdate(t.currentTime-u.startTime))}}catch(o){c.e(o)}finally{c.f()}e&&t.activeModules.length>0&&e(t.currentState),n&&(t.currentState=Object(y["a"])({},R),e&&e(t.currentState))}),this.updateFrequency)}},{key:"stop",value:function(){clearInterval(this.tickId);var e,t=Object(g["a"])(this.timeoutIds);try{for(t.s();!(e=t.n()).done;){var n=e.value;clearTimeout(n)}}catch(r){t.e(r)}finally{t.f()}this.currentTime=0}}]),e}(),W=function(e){Object(a["a"])(n,e);var t=Object(i["a"])(n);function n(){return Object(o["a"])(this,n),t.apply(this,arguments)}return Object(u["a"])(n)}(d["b"]);W=Object(s["a"])([Object(d["a"])({data:function(){var e,t=[];return{audio:null,duration:12e4,currentTime:0,progressWidth:0,engine:e,flags:t}},mounted:function(){var e=this;this.$store;this.audio=new Audio,this.audio.src="https://www.dl-sounds.com/wp-content/uploads/edd/2015/09/Carol-of-the-Bells-preview.mp3",this.audio.ontimeupdate=this.generateTime,this.audio.onloadedmetadata=this.updateDuration,this.engine=new N(2e4,100),window.addEventListener("keypress",(function(t){"KeyM"===t.code&&e.addFlag(),"Space"===t.code&&e.playPause()}))},methods:{generateTime:function(){var e=100/this.audio.duration*this.audio.currentTime;this.progressWidth=e,this.currentTime=1e3*this.audio.currentTime},playPause:function(){this.audio.paused?(this.audio.play(),this.engine.setup(),this.engine.start()):(this.audio.pause(),this.audio.currentTime=0,this.engine.stop())},updateDuration:function(){this.duration=1e3*this.audio.duration},selectModule:function(e,t){this.$store.commit(U,t)},addFlag:function(){var e=this.currentTime;this.flags.push({time:Math.round(e)})},updateSelectedGroup:function(e,t){this.$store.commit(J,t)}},computed:{engineModules:function(){return this.$store.state.engine.modules},modulesGroupedByLedGroup:function(){var e=this.engineModules,t=e.reduce((function(e,t){return(e["".concat(t.leds)]=e["".concat(t.leds)]||[]).push(t),e}),{});return t}}})],W);var z=W,K=(n("9fde"),n("6b0d")),H=n.n(K);const Q=H()(z,[["render",v],["__scopeId","data-v-868d3726"]]);var X=Q,Y={id:"strip"},Z={class:"strip_list"};function ee(e,t,n,c,u,o){return Object(r["j"])(),Object(r["d"])("div",Y,[Object(r["e"])("ul",Z,[(Object(r["j"])(!0),Object(r["d"])(r["a"],null,Object(r["p"])(e.strip.length-1,(function(t){return Object(r["j"])(),Object(r["d"])("li",{key:t},[Object(r["e"])("div",{class:"led",style:Object(r["i"])("background-color: rgb(".concat(e.ledState(t).r,", ").concat(e.ledState(t).g,", ").concat(e.ledState(t).b,")"))},null,4)])})),128))])])}var te=function(e){Object(a["a"])(n,e);var t=Object(i["a"])(n);function n(){return Object(o["a"])(this,n),t.apply(this,arguments)}return Object(u["a"])(n)}(d["b"]);te=Object(s["a"])([Object(d["a"])({data:function(){var e=new Array(50).fill({r:0,g:0,b:0});return{strip:e}},computed:{ledArrayState:function(){return Object(M["b"])(V).state.engine.currentState}},methods:{ledState:function(e){return this.ledArrayState["".concat(e)]}}})],te);var ne=te;n("a710");const re=H()(ne,[["render",ee],["__scopeId","data-v-75bcc718"]]);var ce,ue=re,oe={key:0,id:"module_editor"},ae=Object(r["f"])(" Modifica modulo: "),ie=Object(r["e"])("label",{for:"start"}," Partenza ",-1),se=Object(r["e"])("label",{for:"duration"}," Durata ",-1),de=Object(r["e"])("label",{for:"leds"}," Leds ",-1),le=["value"],be={key:1,id:"module_editor"},fe=Object(r["f"])(" Aggiungi modulo: "),je=Object(r["e"])("label",{for:"start"}," Partenza ",-1),pe=Object(r["e"])("label",{for:"duration"}," Durata ",-1),Oe=Object(r["e"])("label",{for:"leds"}," Leds ",-1),he=["value"];function ve(e,t,n,c,u,o){var a=this;return Object(r["j"])(),Object(r["d"])(r["a"],null,[e.selectedModule?(Object(r["j"])(),Object(r["d"])("div",oe,[ae,ie,Object(r["u"])(Object(r["e"])("input",{type:"text",ref:"start","onUpdate:modelValue":t[0]||(t[0]=function(t){return e.selectedModule.startTime=t})},null,512),[[r["s"],e.selectedModule.startTime,void 0,{number:!0}]]),se,Object(r["u"])(Object(r["e"])("input",{type:"text",ref:"duration","onUpdate:modelValue":t[1]||(t[1]=function(t){return e.selectedModule.duration=t})},null,512),[[r["s"],e.selectedModule.duration,void 0,{number:!0}]]),de,Object(r["e"])("input",{type:"text",ref:"leds",value:e.selectedModule.leds,onChange:t[2]||(t[2]=function(t){return e.selectedModule.leds=JSON.parse("[".concat(t.target.value,"]"))})},null,40,le),Object(r["e"])("button",{onClick:t[3]||(t[3]=function(){return e.removeModule&&e.removeModule.apply(e,arguments)})},"Rimuovi")])):Object(r["c"])("",!0),e.selectedModuleGroup?(Object(r["j"])(),Object(r["d"])("div",be,[fe,je,Object(r["u"])(Object(r["e"])("input",{type:"text",ref:"start","onUpdate:modelValue":t[4]||(t[4]=function(t){return e.newModule.startTime=t})},null,512),[[r["s"],e.newModule.startTime,void 0,{number:!0}]]),pe,Object(r["u"])(Object(r["e"])("input",{type:"text",ref:"duration","onUpdate:modelValue":t[5]||(t[5]=function(t){return e.newModule.duration=t})},null,512),[[r["s"],e.newModule.duration,void 0,{number:!0}]]),Oe,Object(r["e"])("input",{type:"text",ref:"leds",value:e.newModule.leds,onChange:t[6]||(t[6]=function(t){return e.newModule.leds=a.fromStringToArray(t.target.value)})},null,40,he),Object(r["e"])("button",{onClick:t[7]||(t[7]=function(){return e.addModule&&e.addModule.apply(e,arguments)})},"Aggiungi")])):Object(r["c"])("",!0)],64)}var me=function(e){Object(a["a"])(n,e);var t=Object(i["a"])(n);function n(){return Object(o["a"])(this,n),t.apply(this,arguments)}return Object(u["a"])(n)}(d["b"]);me=Object(s["a"])([Object(d["a"])({data:function(){return{selectedModule:null,selectedModuleGroup:null,newModule:new T({duration:0,startTime:0,leds:[]})}},methods:{addModule:function(){this.$store.commit(D,this.newModule),this.newModule=new T({duration:0,startTime:0,leds:this.selectedModuleGroup?this.fromStringToArray(this.selectedModuleGroup):[]})},removeModule:function(){this.$store.commit(I,this.selectedModule.id)},fromStringToArray:function(e){return JSON.parse("[".concat(e,"]"))}},watch:(ce={},Object(m["a"])(ce,"$store.state.ui.selectedModule",(function(e,t){this.selectedModule=e})),Object(m["a"])(ce,"$store.state.ui.selectedModuleGroup",(function(e,t){this.newModule.leds=this.fromStringToArray(e),this.selectedModuleGroup=e})),ce)})],me);var ge=me;const ye=H()(ge,[["render",ve]]);var Me=ye,Se={id:"ble_connector"},we={key:0,class:"connection_info"};function Te(e,t,n,c,u,o){return Object(r["j"])(),Object(r["d"])("div",Se,[Object(r["e"])("button",{onClick:t[0]||(t[0]=function(){return e.connectToDevice&&e.connectToDevice.apply(e,arguments)})},"Connetti"),e.connected?(Object(r["j"])(),Object(r["d"])("div",we)):Object(r["c"])("",!0)])}var ke=n("1da1"),Ae=(n("96cf"),n("5cc6"),n("907a"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("5db7"),n("73d9"),n("07ac"),n("0481"),n("4069"),function(e){Object(a["a"])(n,e);var t=Object(i["a"])(n);function n(){return Object(o["a"])(this,n),t.apply(this,arguments)}return Object(u["a"])(n)}(d["b"]));Ae=Object(s["a"])([Object(d["a"])({data:function(){var e=null,t=!1;return{characteristic:e,connected:t}},methods:{connectToDevice:function(){var e=this;return Object(ke["a"])(regeneratorRuntime.mark((function t(){var n,r,c,u,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={acceptAllDevices:!0,optionalServices:["8075bcec-77f1-49b0-84cb-1ecaecdc31e0"]},t.prev=1,console.log("Requesting Bluetooth Device..."),console.log("with "+JSON.stringify(n)),t.next=6,navigator.bluetooth.requestDevice(n);case 6:return u=t.sent,t.next=9,null===(r=u.gatt)||void 0===r?void 0:r.connect();case 9:return t.next=11,null===(c=u.gatt)||void 0===c?void 0:c.getPrimaryService("8075bcec-77f1-49b0-84cb-1ecaecdc31e0");case 11:return o=t.sent,t.next=14,null===o||void 0===o?void 0:o.getCharacteristic("beb5483e-36e1-4688-b7f5-ea07361b26a8");case 14:e.characteristic=t.sent,e.connected=!0,console.log("Connected"),t.next=22;break;case 19:t.prev=19,t.t0=t["catch"](1),console.log("Argh! "+t.t0);case 22:case"end":return t.stop()}}),t,null,[[1,19]])})))()},writeValue:function(e){var t=this;return Object(ke["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r=t.characteristic,null===r||void 0===r||r.writeValue(new Uint8Array(t.flatLedState(e).map((function(e){return Math.round(e)})))).catch((function(e){console.log("Gesù non inviato")}));case 2:case"end":return n.stop()}}),n)})))()},flatLedState:function(e){var t=Object.values(e).flatMap((function(e){return Object.values(e)}));return t.flat()}},watch:Object(m["a"])({},"$store.state.engine.currentState",(function(e,t){this.writeValue(e)}))})],Ae);var _e=Ae;n("fe48");const xe=H()(_e,[["render",Te],["__scopeId","data-v-20305370"]]);var Ce=xe,Ge=function(e){Object(a["a"])(n,e);var t=Object(i["a"])(n);function n(){return Object(o["a"])(this,n),t.apply(this,arguments)}return Object(u["a"])(n)}(d["b"]);Ge=Object(s["a"])([Object(d["a"])({components:{Editor:X,Strip:ue,ModuleEditor:Me,BLEConnector:Ce},methods:{}})],Ge);var qe=Ge;n("0772");const Pe=H()(qe,[["render",c]]);var Le=Pe;Object(r["b"])(Le).use(B,V).mount("#app")},fe48:function(e,t,n){"use strict";n("514f")}});
//# sourceMappingURL=app.ea4ede40.js.map